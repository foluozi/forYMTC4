# 做指数平滑
# 1、删除与其他点差异过大的点
# 2、将每个数据点替换为前面数据点的指数移动平均值，以得到光滑的曲线
import numpy

average_mae_history = [4.50585550069809, 3.3422991037368774, 3.0225237011909485, 2.829634666442871, 2.896353542804718,
                       2.6630693674087524, 2.6431453824043274, 2.588195323944092, 2.4774003326892853,
                       2.7277349829673767, 2.5422518253326416, 2.416140556335449, 2.681349754333496, 2.4186038970947266,
                       2.577617347240448, 2.577350437641144, 2.363103538751602, 2.482476055622101, 2.5330281257629395,
                       2.60515633225441, 2.4877442717552185, 2.507484555244446, 2.5581751465797424, 2.447380840778351,
                       2.383976101875305, 2.454019010066986, 2.4886229634284973, 2.3593893349170685, 2.4259069561958313,
                       2.6064831018447876, 2.5577779412269592, 2.5142504572868347, 2.4559783339500427,
                       2.530082017183304, 2.4675180315971375, 2.3640257120132446, 2.4005759358406067,
                       2.4124494791030884, 2.441424310207367, 2.4638965129852295, 2.4609296321868896,
                       2.4934375882148743, 2.3940378427505493, 2.3737286925315857, 2.368119955062866, 2.394901394844055,
                       2.29045307636261, 2.362359255552292, 2.3707290291786194, 2.352591037750244, 2.3407161235809326,
                       2.4127904772758484, 2.455493748188019, 2.384842813014984, 2.3631955981254578, 2.4984149634838104,
                       2.3896390199661255, 2.4289501905441284, 2.315247118473053, 2.423454701900482, 2.3017786741256714,
                       2.512997627258301, 2.403256982564926, 2.3755689561367035, 2.2283757627010345, 2.4557025134563446,
                       2.504486083984375, 2.440167546272278, 2.400978922843933, 2.426243841648102, 2.4372085332870483,
                       2.4685213565826416, 2.43244868516922, 2.3653094470500946, 2.4738951921463013, 2.644144833087921,
                       2.4205272793769836, 2.5536279678344727, 2.40281081199646, 2.574117600917816, 2.552704334259033,
                       2.4647799134254456, 2.502793848514557, 2.4371212124824524, 2.5304035544395447, 2.436548590660095,
                       2.6189459562301636, 2.468939423561096, 2.4505059719085693, 2.403363347053528, 2.7198155522346497,
                       2.496179938316345, 2.4494300484657288, 2.4396265745162964, 2.494752883911133, 2.4011107683181763,
                       2.405147910118103, 2.432294011116028, 2.4110068678855896, 2.4875949025154114, 2.4778393507003784,
                       2.5804149508476257, 2.520601451396942, 2.5616671442985535, 2.427675187587738, 2.4568058252334595,
                       2.5230494141578674, 2.5238381028175354, 2.638646364212036, 2.5390664935112, 2.522654414176941,
                       2.4830376505851746, 2.4374471306800842, 2.594553291797638, 2.601057469844818, 2.4587717056274414,
                       2.5278199911117554, 2.7071295380592346, 2.482374131679535, 2.5387280583381653,
                       2.6940417885780334, 2.487016797065735, 2.6290600299835205, 2.728850483894348, 2.5399529933929443,
                       2.5481210947036743, 2.600469946861267, 2.551904320716858, 2.572296679019928, 2.718653678894043,
                       2.5871466398239136, 2.5840576887130737, 2.5854052901268005, 2.6517950892448425,
                       2.568701922893524, 2.55765438079834, 2.549439311027527, 2.6507527828216553, 2.555389881134033,
                       2.5284515619277954, 2.533601939678192, 2.6765410900115967, 2.6485924124717712,
                       2.5897587537765503, 2.545271635055542, 2.5809788703918457, 2.5481560826301575, 2.662420928478241,
                       2.587260067462921, 2.619149684906006, 2.592913568019867, 2.5443626046180725, 2.5706207156181335,
                       2.557432472705841, 2.5924904346466064, 2.519234359264374, 2.621609091758728, 2.6500092148780823,
                       2.617262303829193, 2.6465234756469727, 2.5926222801208496, 2.5793145298957825, 2.632849156856537,
                       2.6482611298561096, 2.5594183802604675, 2.59502637386322, 2.54319304227829, 2.5499953627586365,
                       2.8580833077430725, 2.590468108654022, 2.6633201837539673, 2.6340534687042236,
                       2.6637268662452698, 2.6708505749702454, 2.57009494304657, 2.7495914697647095, 2.5521896481513977,
                       2.5587769150733948, 2.5815484523773193, 2.6345036029815674, 2.6239914894104004,
                       2.5772103667259216, 2.529801070690155, 2.5577635765075684, 2.6590129733085632, 2.804438889026642,
                       2.7545101046562195, 2.602805256843567, 2.6706926822662354, 2.5867303013801575,
                       2.6492592692375183, 2.6749964356422424, 2.64436411857605, 2.6179606318473816, 2.6038045287132263,
                       2.5813316702842712, 2.747764468193054, 2.5996375679969788, 2.6036107540130615,
                       2.6022737622261047, 2.721849739551544, 2.647142171859741, 2.693391740322113, 2.7269747257232666,
                       2.615947425365448, 2.838418424129486, 2.687286674976349, 2.6342573761940002, 2.593342900276184,
                       2.626561939716339, 2.687648117542267, 2.7521939277648926, 2.641622304916382, 2.703256368637085,
                       2.7221937775611877, 2.696157455444336, 2.6429617404937744, 2.659634828567505, 2.670981764793396,
                       2.696823835372925, 2.6299586296081543, 2.777346193790436, 2.6356506943702698, 2.6436545848846436,
                       2.650335371494293, 2.5428637862205505, 2.6749749183654785, 2.6946301460266113, 2.769413709640503,
                       2.6368203163146973, 2.682293713092804, 2.852229058742523, 2.883526921272278, 2.6028361916542053,
                       2.7540151476860046, 2.667350649833679, 2.721756398677826, 2.6914074420928955, 2.811968147754669,
                       2.7163884043693542, 2.69494891166687, 2.7983649373054504, 2.667914390563965, 2.7352429628372192,
                       2.796416401863098, 2.698074460029602, 2.7168776988983154, 2.7416727542877197, 2.6784778833389282,
                       2.7465896010398865, 2.6338926553726196, 2.8021106719970703, 2.780344247817993,
                       2.7036439180374146, 2.7336661219596863, 2.730003595352173, 2.77817565202713, 2.61577445268631,
                       2.7045764923095703, 2.673608899116516, 2.6491047143936157, 2.7512747645378113,
                       2.7878133058547974, 2.68120801448822, 2.6770126819610596, 2.805164933204651, 2.7653653025627136,
                       2.7385616302490234, 2.744581937789917, 2.7287875413894653, 2.6100635528564453,
                       2.6430432200431824, 2.6015378832817078, 2.8006798028945923, 2.8083901405334473,
                       2.673928737640381, 2.6934422850608826, 2.725802004337311, 2.7611459493637085, 2.8289875388145447,
                       2.792312800884247, 2.7495657801628113, 2.803398907184601, 2.7601612210273743, 2.6941781640052795,
                       2.818287491798401, 2.696109116077423, 2.7971097230911255, 2.766086757183075, 2.695152759552002,
                       2.8612576723098755, 2.902779996395111, 2.745173156261444, 2.7487111687660217, 2.7355377674102783,
                       2.7391245365142822, 2.777614116668701, 2.7359375953674316, 2.7670875191688538,
                       2.6404083371162415, 2.9400219917297363, 2.6745044589042664, 2.6354315280914307,
                       2.762480318546295, 2.6785072088241577, 2.7894996404647827, 2.862908959388733, 2.8097780346870422,
                       2.667855679988861, 2.7287408113479614, 2.8238000869750977, 2.693794369697571, 2.7593032121658325,
                       2.7160069942474365, 2.7435184121131897, 2.848148822784424, 2.786316931247711, 2.8074413537979126,
                       2.856988787651062, 2.8118229508399963, 2.7488259077072144, 2.7320372462272644, 2.790397584438324,
                       2.7530819177627563, 2.7377641201019287, 2.7244685888290405, 2.693871259689331, 2.81108820438385,
                       2.9315611124038696, 2.7322977781295776, 2.8181825280189514, 2.830651819705963, 2.679904580116272,
                       2.638024687767029, 2.862904906272888, 2.8703606128692627, 2.7765645384788513, 2.7412856817245483,
                       2.7321471571922302, 2.816475510597229, 2.88498854637146, 2.727338671684265, 2.782493233680725,
                       2.702466130256653, 2.9226388335227966, 2.8294792771339417, 2.7613826394081116,
                       2.7558836340904236, 2.73919814825058, 2.8413219451904297, 2.7658478021621704, 2.770289719104767,
                       2.8583924770355225, 2.818751871585846, 2.7404531836509705, 2.7740739583969116,
                       2.7216633558273315, 2.8426734805107117, 2.815058708190918, 2.8209453225135803,
                       2.8491138219833374, 2.7743963599205017, 2.7399044036865234, 2.793552041053772, 2.703957438468933,
                       2.711529016494751, 2.809711754322052, 2.7940627336502075, 2.8325815200805664, 2.82142436504364,
                       2.7987141013145447, 2.9055027961730957, 2.749942362308502, 2.834592878818512, 2.8019617199897766,
                       2.8138685822486877, 2.848253905773163, 2.8033552765846252, 2.739884614944458, 2.7241968512535095,
                       2.7911139726638794, 2.840276002883911, 2.8362578749656677, 2.7915266156196594,
                       2.8616597652435303, 2.852277159690857, 2.779493749141693, 2.8063719272613525, 2.8408697843551636,
                       2.800519108772278, 2.77955961227417, 2.7515000700950623, 2.863190770149231, 2.7187774181365967,
                       2.8349140286445618, 2.8061713576316833, 2.8346633911132812, 2.8117436170578003,
                       2.8914161920547485, 2.7860438227653503, 2.8588467240333557, 2.7315776348114014,
                       2.8050910234451294, 2.8688198924064636, 2.9528271555900574, 2.7920015454292297,
                       2.739034593105316, 2.922268807888031, 2.875385344028473, 2.862254559993744, 2.927385687828064,
                       2.8712491393089294, 2.8023682832717896, 2.8660972714424133, 2.807601034641266,
                       2.8446463346481323, 2.878120481967926, 2.8133656978607178, 2.80533903837204, 2.870261490345001,
                       2.7263785004615784, 2.8501914739608765, 2.8348077535629272, 2.851983070373535, 2.930083990097046,
                       2.792358160018921, 2.768102288246155, 2.886454224586487, 2.84492951631546, 2.759461522102356,
                       2.799707591533661, 2.867223381996155, 2.863775849342346, 2.8367470502853394, 2.7289037704467773,
                       2.790382206439972, 2.8176379203796387, 2.89986515045166, 2.8981953859329224, 2.817650556564331,
                       2.825346529483795, 2.900015413761139, 2.826069474220276, 2.934015214443207, 2.8368935585021973,
                       2.8567981719970703, 2.9150506258010864, 2.9095319509506226, 2.894876480102539,
                       2.7934528589248657, 2.803522288799286, 2.821436285972595, 2.744644343852997, 2.785857379436493,
                       2.8391011357307434, 2.8412890434265137, 2.9264495968818665, 2.766772747039795, 2.857969343662262,
                       2.8488045930862427, 2.806152045726776, 2.776505470275879, 2.7093002796173096, 3.045336127281189,
                       2.8091400265693665, 2.7388563752174377, 2.723211646080017, 2.8841561675071716,
                       2.8350218534469604, 2.835569739341736, 2.7734802961349487, 2.7594195008277893,
                       2.8120373487472534, 2.8512282371520996, 2.728988528251648, 2.7670925855636597,
                       2.9218252897262573, 2.760262429714203, 2.7893117666244507, 2.8108733892440796, 2.740929663181305,
                       2.8626543283462524, 2.889391243457794, 2.747863292694092, 2.8977490663528442, 2.8016445636749268,
                       2.828801691532135, 2.7335379123687744, 2.936847448348999, 2.8765628933906555, 2.8202545642852783,
                       2.7988009452819824, 2.807398200035095, 2.7798200249671936, 2.9359803795814514,
                       2.8215787410736084, 2.7963306307792664, 2.84979784488678, 2.808709681034088, 2.817772328853607]
print(len(average_mae_history))


def smooth_curve(points, factor=0.9):
    smothed_points = []
    for point in points:
        if smothed_points:
            previous = smothed_points[-1]
            smothed_points.append(previous * factor + point * (1 - factor))
        else:
            smothed_points.append(point)
    return smothed_points


smooth_mae_history = smooth_curve(average_mae_history[10:])

import matplotlib.pyplot as plt
import seaborn as sns

sns.set(style='white', font='FangSong')
fig2 = plt.figure()
plt.plot(range(1, len(smooth_mae_history) + 1), smooth_mae_history)
plt.xlabel('Epochs')
plt.ylabel('Validation MAE')
plt.show()

print(numpy.argmin(average_mae_history), numpy.min(average_mae_history))
print(numpy.argmin(smooth_mae_history) + 10)  # 选取到mae最小的迭代次数 + 10 （10为之前减去的）
print(numpy.min(smooth_mae_history))

# 知道mae 最小的迭代次数后，再使用这个迭代次数进行最终的训练
